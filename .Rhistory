"Participants: Women (15-49 years)"="Female"
))
totalinterviewvisuals <- fread("data/table_1/table1_kdhshouseholdinterviews1.csv")
renderPlot({
plot_data <- totalinterviewvisuals
if (input$quest %in% "Response Rate") {
plot_data <- plot_data[Participant == "Response Rate"]
} else {
plot_data <- plot_data[Gender %in% input$quest & Participant != "Response Rate"]
}
ggplot(plot_data, aes(x = Respondents, y = numbers)) +
geom_bar(stat = "identity", position = position_dodge(), fill = "cyan4") +
theme_bw() +
geom_text(aes(label = ifelse(input$quest %in% "Response Rate",
paste0(round(numbers), "%"),
format(numbers, big.mark = ","))),
size = 5, hjust = 1.5, color = "white") +
scale_y_continuous(label = scales::comma) +
coord_flip() +
labs(x = "Households", y = "", fill = "Residence") +
facet_grid(residence ~ selection) +
theme(text = element_text(size = 20, color = "black", face = "bold")) +
theme(strip.background = element_rect(fill = "darkorange"))
})
profvis::profvis({
selectInput("quest", "",
c("Response Rates"="Response Rate",
"Households"="All",
"Participants: Men (15-54 years)"="Male",
"Participants: Women (15-49 years)"="Female"
))
totalinterviewvisuals <- fread("data/table_1/table1_kdhshouseholdinterviews1.csv")
renderPlot({
plot_data <- totalinterviewvisuals
if (input$quest %in% "Response Rate") {
plot_data <- plot_data[Participant == "Response Rate"]
} else {
plot_data <- plot_data[Gender %in% input$quest & Participant != "Response Rate"]
}
ggplot(plot_data, aes(x = Respondents, y = numbers)) +
geom_bar(stat = "identity", position = position_dodge(), fill = "cyan4") +
theme_bw() +
geom_text(aes(label = ifelse(input$quest %in% "Response Rate",
paste0(round(numbers), "%"),
format(numbers, big.mark = ","))),
size = 5, hjust = 1.5, color = "white") +
scale_y_continuous(label = scales::comma) +
coord_flip() +
labs(x = "Households", y = "", fill = "Residence") +
facet_grid(residence ~ selection) +
theme(text = element_text(size = 20, color = "black", face = "bold")) +
theme(strip.background = element_rect(fill = "darkorange"))
})
})
profvis::profvis({
insurance_county <- fread("data/table_2/table_2_20C_insurance_by_county.csv")
county <- st_read("shapefiles/County.shp")
insurance_county1 <- full_join(county, insurance_county, by=c("Name"="County"))
})
selectInput("school_attendance", "",
c("Residence"="Residence",
"Wealth quintile"="Wealth quintile",
"County"="County"))
# Define reactive data sources
school_att_county <- reactive({
fread("data/table_2/table_2_12C_School_attendance_by_county.csv") %>%
filter(!(Category %in% "Gender Parity Index")) %>%
mutate(cat = fifelse(
Proportion < 52, "<52", fifelse(Proportion > 51 & Proportion < 76, "51-75",
fifelse(Proportion > 75 & Proportion < 90, "75-89",
fifelse(Proportion > 89 & Proportion < 104, "90-103", ">103"))))
)})
school_attendance <- reactive({
fread("data/table_2/table_2_12_School_attendance_by_background_xtics.csv") %>%
mutate(Proportion = ifelse(Proportion > 0.5, round(Proportion), Proportion)) %>%
mutate(Value = fct_relevel(Value, "Lowest", "Second", "Middle", "Fourth", "Highest"))
})
# Render the plot
renderGirafe({
if(input$school_attendance != "County") {
school_att_data <- school_attendance() %>%
filter(`Background characteristics` %in% input$school_attendance)
school_att_plot <- ggplot(school_att_data, aes(x = Value, y = Proportion, fill = Category)) +
geom_bar(stat = 'identity', position = position_dodge()) +
facet_wrap(~ `Schooling level`) +
labs(y = "Percent (%)", x = "", fill = "") + ylim(0, 100) +
scale_fill_brewer(palette = "Set1") + coord_flip() +
theme_bw() + theme(text = element_text(size = 16, face = "bold")) +
theme(strip.background = element_rect(fill = "darkorange")) +
geom_text(aes(label = paste0(Proportion, "%")), position = position_dodge(width = 1),
vjust = 0.5, hjust = -0.2, size = 4, color = "black")
school_att_plot_girafe <- girafe(ggobj = school_att_plot,
options = list(opts_zoom(max = 6)), width = 12, height = 5)
print(school_att_plot_girafe)
} else {
school_att_map <- ggplot(school_att_county1()) +
geom_sf_interactive(data = school_att_county1(), aes(geometry = geometry, tooltip = Names, fill = cat),
color = "grey80", size = 0.0) +
theme_void() +
facet_wrap(Ratio ~ Category, nrow = 1) +
scale_fill_manual(values = brewer_pal(palette = "Greens")(5)) +
labs(x = "", y = "", fill = "Ratio") +
theme(text = element_text(size = 18))
school_att_map_girafe <- girafe(ggobj = school_att_map,
options = list(opts_zoom(max = 6)), width = 12, height = 5)
print(school_att_map_girafe, justify = "left")
}
})
profvis::profvis({
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index"))
breaks<- classIntervals(school_att_county$Proportion, n=5, style="quantile", na.rm=T)
school_att_county <- school_att_county |>
mutate(cat=fifelse(Proportion<52, "<52", fifelse(Proportion>51 & Proportion<76, "51-75", fifelse(Proportion>75 & Proportion <90, "75-89",
fifelse(Proportion>89&Proportion<104, "90-103", ">103")))))
school_att_county$cat <- fct_relevel(school_att_county$cat, "<52", "51-75", "75-89", "90-103", ">103")
county <- st_read("shapefiles/County.shp")
school_att_county1 <- full_join(county, school_att_county, by=c("Name"="County"))
})
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index"))
breaks<- classIntervals(school_att_county$Proportion, n=5, style="quantile", na.rm=T)
school_att_county <- school_att_county |>
mutate(cat=fifelse(Proportion<52, "<52", fifelse(Proportion>51 & Proportion<76, "51-75", fifelse(Proportion>75 & Proportion <90, "75-89",
fifelse(Proportion>89&Proportion<104, "90-103", ">103")))))
school_att_county$cat <- fct_relevel(school_att_county$cat, "<52", "51-75", "75-89", "90-103", ">103")
county <- st_read("shapefiles/County.shp")
school_att_county1 <- full_join(county, school_att_county, by=c("Name"="County"))
county_updated <- st_read("shapefiles/County.shp")|>
mutate(region=fifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", fifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", fifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", fifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", fifelse(Name%in%c("Bungoma",
"Busia","Kakamega","Vihiga"),"Western", fifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", fifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))|>
rename(County=Name)
#setwd("~/")
# load all the required packages
library(pacman)
p_load(shiny, docxtractr,flexdashboard, tidyverse,ggiraph, scales, sf, reshape2, cowplot, data.table, classInt, microbenchmark)
library(profvis)
county_updated <- st_read("shapefiles/County.shp")|>
mutate(region=fifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", fifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", fifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", fifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", fifelse(Name%in%c("Bungoma",
"Busia","Kakamega","Vihiga"),"Western", fifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", fifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))|>
rename(County=Name)
View(county_updated)
insurance <- fread("data/table_2/table_2_20_insurance_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(insurance,"data_2/table_2/table_2_20_insurance_by_background_xtics.csv", row.names = FALSE)
View(insurance)
insurance <- fread("data_2/table_2/table_2_20_insurance_by_background_xtics.csv")
insurance <- fread("data_2/table_2/table_2_20_insurance_by_background_xtics.csv")
View(insurance)
insurance <- fread("data_2/table_2/table_2_20_insurance_by_background_xtics.csv")
insurance$Value<- fct_relevel(insurance$Value,
"Lowest", "Second", "Middle", "Fourth", "Highest")
insurance$`Health Insurance Type` <- fct_relevel(insurance$`Health Insurance Type`, "None/Don't know", "Any", "NHIF", "Community-based", "Private/commercial", "Other")
hh_possession <- fread("data/table_2/table2_5_HH_possession.csv")
View(hh_possession)
hh_possession <- fread("data/table_2/table2_5_HH_possession.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
View(hh_possession)
hh_possession <- fread("data/table_2/table2_5_HH_possession.csv")
hh_possession <- fread("data/table_2/table2_5_HH_possession.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
hh_possession <- fread("data/table_2/table2_5_HH_possession.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(hh_possession,"data_2/table_2/table2_5_HH_possession.csv", row.names = FALSE)
hh_possession <- fread("data_2/table_2/table2_5_HH_possession.csv")
View(hh_possession)
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))
View(birth_reg_county)
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")
View(birth_reg_county)
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))
write.csv(birth_reg_county,"data_2/table_2/table2_10C_Birth_registration_by_county.csv", row.names = FALSE)
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51",
fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
View(birth_reg_county)
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
write.csv(birth_reg_county,"data_2/table_2/table2_10C_Birth_registration_by_county.csv", row.names = FALSE)
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
write.csv(birth_reg_county,"data_2/table_2/table2_10C_Birth_registration_by_county.csv", row.names = FALSE)
birth_reg_county <- fread("data/table_2/table2_10C_Birth_registration_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
write.csv(birth_reg_county,"data_2/table_2/table2_10C_Birth_registration_by_county.csv", row.names = FALSE)
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")
|>
birth_reg_county <- fread("data_2/table_2/table2_10C_Birth_registration_by_county.csv")
# |>
#   mutate(Proportion=as.numeric(Proportion))|>
#   mutate(cat=fifelse(Proportion<31, "<31", fifelse(Proportion>30 & Proportion<43, "31-42", fifelse(Proportion>42 & Proportion <52, "43-51", fifelse(Proportion>51&Proportion<73, "52-72", ">73")))))
breaks<- classIntervals(birth_reg_county$Proportion, n=5, style="quantile", na.rm=T)
birth_reg_county$cat <- fct_relevel(birth_reg_county$cat, "<31", "31-42", "43-51", "52-72", ">73")
birth_reg_county1 <- full_join(county, birth_reg_county, by=c("Name"="County"))
birth_reg <- fread("data/table_2/table2_10_Birth_registration_by_background_xtics.csv")|>
mutate(Proportion=as.numeric(Proportion)) |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
View(birth_reg)
birth_reg <- fread("data/table_2/table2_10_Birth_registration_by_background_xtics.csv")|>
mutate(Proportion=as.numeric(Proportion)) |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(birth_reg,"data_2/table_2/table2_10_Birth_registration_by_background_xtics.csv", row.names = FALSE)
birth_reg <- fread("data_2/table_2/table2_10_Birth_registration_by_background_xtics.csv")
# |>
#   mutate(Proportion=as.numeric(Proportion)) |>
#   mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
birth_reg$Value<- fct_relevel(birth_reg$Value,
"Lowest", "Second", "Middle", "Fourth", "Highest")
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")
View(school_att_county)
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index"))
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index"))
write.csv(school_att_county,"data_2/table_2/table_2_12C_School_attendance_by_county.csv", row.names = FALSE)
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")
View(school_att_county)
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index")) |>
mutate(cat=fifelse(Proportion<52, "<52", fifelse(Proportion>51 & Proportion<76, "51-75", fifelse(Proportion>75 & Proportion <90, "75-89",                                             fifelse(Proportion>89&Proportion<104, "90-103", ">103")))))
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")|>
filter(!(Category%in%"Gender Parity Index")) |>
mutate(cat=fifelse(Proportion<52, "<52", fifelse(Proportion>51 & Proportion<76, "51-75", fifelse(Proportion>75 & Proportion <90, "75-89",                                             fifelse(Proportion>89&Proportion<104, "90-103", ">103")))))
write.csv(school_att_county,"data_2/table_2/table_2_12C_School_attendance_by_county.csv", row.names = FALSE)
school_att_county <- fread("data/table_2/table_2_12C_School_attendance_by_county.csv")
school_att_county <- fread("data_2/table_2/table_2_12C_School_attendance_by_county.csv")
school_attendance <- fread("data/table_2/table_2_12_School_attendance_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(school_attendance,"data_2/table_2/table_2_12_School_attendance_by_background_xtics.csv", row.names = FALSE)
RTA <- fread("data/table_2/table_2_17_RTA_by_background_xtics.csv")
View(RTA)
RTA <- fread("data/table_2/table_2_17_RTA_by_background_xtics.csv") |>
mutate(Proportion=parse_number(Proportion))
RTA <- fread("data/table_2/table_2_17_RTA_by_background_xtics.csv") |>
mutate(Proportion=parse_number(Proportion))
write.csv(RTA,"data_2/table_2/table_2_17_RTA_by_background_xtics.csv", row.names = FALSE)
RTA_county <- fread("data/table_2/table_2_17_RTA_by_county.csv")
View(RTA_county)
RTA_county <- fread("data/table_2/table_2_17_RTA_by_county.csv") |>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<33, "<33", fifelse(Proportion>32 & Proportion<85, "33-84", fifelse(Proportion>84 & Proportion <211, "85-210",fifelse(Proportion>210 &Proportion<1062, "211-1061", ">1062")))))
covid_county3 <- fread("data/table_2/table_2_19_1C_covid_by_county_bind.csv")
View(covid_county3)
covid_county3 <- fread("data/table_2/table_2_19_1C_covid_by_county_bind.csv")
covid_county3 <- fread("data/table_2/table_2_19_1C_covid_by_county_bind.csv") |>
mutate(cat=fifelse(Proportion<9.6, "<9.6", fifelse(Proportion>9.5 & Proportion<18.7, "9.6-18.6", fifelse(Proportion>18.6 & Proportion <30.1, "18.7-30.0",fifelse(Proportion>30.0&Proportion<48.0, "30.1-47.9", ">48.0")))))
covid_county3 <- fread("data/table_2/table_2_19_1C_covid_by_county_bind.csv") |>
select(-V1) |>
mutate(cat=fifelse(Proportion<9.6, "<9.6", fifelse(Proportion>9.5 & Proportion<18.7, "9.6-18.6", fifelse(Proportion>18.6 & Proportion <30.1, "18.7-30.0",fifelse(Proportion>30.0&Proportion<48.0, "30.1-47.9", ">48.0")))))
covid_county3 <- fread("data/table_2/table_2_19_1C_covid_by_county_bind.csv") |>
select(-V1) |>
mutate(cat=fifelse(Proportion<9.6, "<9.6", fifelse(Proportion>9.5 & Proportion<18.7, "9.6-18.6", fifelse(Proportion>18.6 & Proportion <30.1, "18.7-30.0",fifelse(Proportion>30.0&Proportion<48.0, "30.1-47.9", ">48.0")))))
write.csv(covid_county3,"data_2/table_2/table_2_19_1C_covid_by_county_bind.csv", row.names = FALSE)
county <- st_read("shapefiles/County.shp")
covid_county <- fread("data/table_2/table_2_19_1C_covid_by_county.csv")
covid_county3 <- fread("data_2/table_2/table_2_19_1C_covid_by_county_bind.csv")
# |>
#   select(-V1) |>
#   mutate(cat=fifelse(Proportion<9.6, "<9.6", fifelse(Proportion>9.5 & Proportion<18.7, "9.6-18.6", fifelse(Proportion>18.6 & Proportion <30.1, "18.7-30.0",fifelse(Proportion>30.0&Proportion<48.0, "30.1-47.9", ">48.0")))))
covid_county3 <- full_join(county,covid_county3, by=c("Name"="County"))
breaks<- classIntervals(covid_county3$Proportion, n=5, style="quantile", na.rm=T)
covid_county3$cat <- fct_relevel(covid_county3$cat, "<9.6", "9.6-18.6", "18.7-30.0", "30.1-47.9", ">48.0")
covid <- fread("data/table_2/table_2_19_1_covid_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
View(covid)
covid <- fread("data/table_2/table_2_19_1_covid_by_background_xtics.csv")
covid <- fread("data/table_2/table_2_19_1_covid_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(covid,"data_2/table_2/table_2_19_1_covid_by_background_xtics.csv", row.names = FALSE)
cash_transfer_county <- fread("data/table_2/table_2_22_2C_cash_transfer_by_county.csv")
View(cash_transfer_county)
cash_transfer_county <- fread("data/table_2/table_2_22_2C_cash_transfer_by_county.csv")|>
mutate(cat=fifelse(Proportion<0.7, "<0.7", fifelse(Proportion>0.6 & Proportion<2.6, "0.7-2.5", fifelse(Proportion>2.5 & Proportion <8.1, "2.6-8.0", fifelse(Proportion>8.0&Proportion<20.0, "8.1-19.9", ">19.9")))))
cash_transfer_county <- fread("data/table_2/table_2_22_2C_cash_transfer_by_county.csv")|>
mutate(cat=fifelse(Proportion<0.7, "<0.7", fifelse(Proportion>0.6 & Proportion<2.6, "0.7-2.5", fifelse(Proportion>2.5 & Proportion <8.1, "2.6-8.0", fifelse(Proportion>8.0&Proportion<20.0, "8.1-19.9", ">19.9")))))
write.csv(cash_transfer_county,"data_2/table_2/table_2_22_2C_cash_transfer_by_county.csv", row.names = FALSE)
cash_transfer_county <- fread("data_2/table_2/table_2_22_2C_cash_transfer_by_county.csv")
# |>
#   mutate(cat=fifelse(Proportion<0.7, "<0.7", fifelse(Proportion>0.6 & Proportion<2.6, "0.7-2.5", fifelse(Proportion>2.5 & Proportion <8.1, "2.6-8.0", fifelse(Proportion>8.0&Proportion<20.0, "8.1-19.9", ">19.9")))))
cash_transfer_county1 <- full_join(county, cash_transfer_county, by=c("Name"="County"))
breaks<- classIntervals(cash_transfer_county$Proportion, n=5, style="quantile", na.rm=T)
cash_transfer_county1$cat <- fct_relevel(cash_transfer_county1$cat, "<0.7", "0.7-2.5", "2.6-8.0", "8.1-19.9", ">19.9")
cash_transfer <- fread("data/table_2/table_2_22_1_cash_transfer_by_provider.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(cash_transfer,"data_2/table_2/table_2_22_1_cash_transfer_by_provider.csv", row.names = FALSE)
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
View(respondentsdata)
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
write.csv(respondentsdata,"data_2/table_2/table2_respondentsdata.csv", row.names = FALSE)
respondentsdata$Grouping<- fct_relevel(respondentsdata$Grouping,
"Lowest", "Second", "Middle", "Fourth", "Highest", "No education", "Primary", "Secondary", "More than secondary")
## county data
### men
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men")
county_updated <- st_read("shapefiles/County.shp")|>
mutate(region=fifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", fifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", fifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", fifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", fifelse(Name%in%c("Bungoma",
"Busia","Kakamega","Vihiga"),"Western", fifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", fifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))|>
rename(County=Name)
men_background_xtics_county1 <- full_join(county_updated, men_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
### women
women_background_xtics_county <- fread("data/table_2/table2C_women_backgroundxtics_by_county.csv") |>
mutate(group="Women")
women_background_xtics_county1 <- full_join(county_updated, women_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
background_characteristics_map <- rbind(women_background_xtics_county1, men_background_xtics_county1)
breaks<- classIntervals(background_characteristics_map$weighted_perc, n=5, style="quantile", na.rm=T)
background_characteristics_map <- background_characteristics_map |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
background_characteristics_map$cat <- fct_relevel(background_characteristics_map$cat, "<0.8", "0.8-1.2", "1.3-2.0", "2.1-2.8", ">2.8")
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
write.csv(respondentsdata,"data_2/table_2/table2_respondentsdata.csv", row.names = FALSE)
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv")
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
write.csv(respondentsdata,"data_2/table_2/table2_respondentsdata.csv", row.names = FALSE)
RTA <- fread("data_2/table_2/table_2_17_RTA_by_background_xtics.csv")
View(RTA)
RTA_county <- fread("data/table_2/table_2_17_RTA_by_county.csv")
View(RTA_county)
RTA_county <- fread("data/table_2/table_2_17_RTA_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<33, "<33", fifelse(Proportion>32 & Proportion<85, "33-84", fifelse(Proportion>84 & Proportion <211, "85-210",fifelse(Proportion>210 &Proportion<1062, "211-1061", ">1062")))))
View(RTA_county)
RTA_county <- fread("data/table_2/table_2_17_RTA_by_county.csv")|>
mutate(Proportion=as.numeric(Proportion))|>
mutate(cat=fifelse(Proportion<33, "<33", fifelse(Proportion>32 & Proportion<85, "33-84", fifelse(Proportion>84 & Proportion <211, "85-210",fifelse(Proportion>210 &Proportion<1062, "211-1061", ">1062")))))
write.csv(RTA_county,"data_2/table_2/table_2_17_RTA_by_county.csv", row.names = FALSE)
respondentsdata <- fread("data/table_2/table2_respondentsdata.csv") |>
mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men")
write.csv(men_background_xtics_county,"data_2/table2C_men_backgroundxtics_by_county.csv", row.names = FALSE)
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men")
write.csv(men_background_xtics_county,"data_2/table_2/table2C_men_backgroundxtics_by_county.csv", row.names = FALSE)
View(men_background_xtics_county1)
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
View(men_background_xtics_county)
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
men_background_xtics_county <- fread("data/table_2/table2C_men_backgroundxtics_by_county.csv") |>
mutate(group="Men") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
write.csv(men_background_xtics_county,"data_2/table_2/table2C_men_backgroundxtics_by_county.csv", row.names = FALSE)
women_background_xtics_county <- fread("data/table_2/table2C_women_backgroundxtics_by_county.csv") |>
mutate(group="Women") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
women_background_xtics_county <- fread("data/table_2/table2C_women_backgroundxtics_by_county.csv") |>
mutate(group="Women") |>
mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
write.csv(women_background_xtics_county,"data_2/table_2/table2C_women_backgroundxtics_by_county.csv", row.names = FALSE)
respondentsdata <- fread("data_2/table_2/table2_respondentsdata.csv")
# |>
#   mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
respondentsdata$Grouping<- fct_relevel(respondentsdata$Grouping,
"Lowest", "Second", "Middle", "Fourth", "Highest", "No education", "Primary", "Secondary", "More than secondary")
## county data
### men
men_background_xtics_county <- fread("data_2/table_2/table2C_men_backgroundxtics_by_county.csv")
# |>
#   mutate(group="Men") |>
#   mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
#                                                                                                 fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
county_updated <- st_read("shapefiles/County.shp")|>
mutate(region=fifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", fifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", fifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", fifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", fifelse(Name%in%c("Bungoma",
"Busia","Kakamega","Vihiga"),"Western", fifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", fifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))|>
rename(County=Name)
men_background_xtics_county1 <- full_join(county_updated, men_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
### women
women_background_xtics_county <- fread("data/table_2/table2C_women_backgroundxtics_by_county.csv")
# |>
#   mutate(group="Women") |>
#   mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
#                                                                                                 fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
women_background_xtics_county1 <- full_join(county_updated, women_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
background_characteristics_map <- rbind(women_background_xtics_county1, men_background_xtics_county1)
respondentsdata <- fread("data_2/table_2/table2_respondentsdata.csv")
# |>
#   mutate(Weighted_percent=fifelse(Weighted_percent>0.5, round(Weighted_percent),Weighted_percent))
respondentsdata$Grouping<- fct_relevel(respondentsdata$Grouping,
"Lowest", "Second", "Middle", "Fourth", "Highest", "No education", "Primary", "Secondary", "More than secondary")
## county data
### men
men_background_xtics_county <- fread("data_2/table_2/table2C_men_backgroundxtics_by_county.csv")
# |>
#   mutate(group="Men") |>
#   mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
#                                                                                                 fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
county_updated <- st_read("shapefiles/County.shp")|>
mutate(region=fifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", fifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", fifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", fifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", fifelse(Name%in%c("Bungoma",
"Busia","Kakamega","Vihiga"),"Western", fifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", fifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))|>
rename(County=Name)
men_background_xtics_county1 <- full_join(county_updated, men_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
### women
women_background_xtics_county <- fread("data_2/table_2/table2C_women_backgroundxtics_by_county.csv")
# |>
#   mutate(group="Women") |>
#   mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
#                                                                                                 fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
women_background_xtics_county1 <- full_join(county_updated, women_background_xtics_county, by="County")|>
mutate(names=paste0(County,", ", weighted_perc,"%"))
background_characteristics_map <- rbind(women_background_xtics_county1, men_background_xtics_county1)
breaks<- classIntervals(background_characteristics_map$weighted_perc, n=5, style="quantile", na.rm=T)
# background_characteristics_map <- background_characteristics_map |>
#   mutate(cat=fifelse(weighted_perc<0.8, "<0.8", fifelse(weighted_perc>0.7 & weighted_perc<1.3, "0.8-1.2", fifelse(weighted_perc>1.2 & weighted_perc <2.1, "1.3-2.0",
#                                                                                                 fifelse(weighted_perc>2.0&weighted_perc<2.9, "2.1-2.8", ">2.8")))))
background_characteristics_map$cat <- fct_relevel(background_characteristics_map$cat, "<0.8", "0.8-1.2", "1.3-2.0", "2.1-2.8", ">2.8")
View(background_characteristics_map)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",
fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv")
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))),
Participant =ifelse(Participants=="Women","Women","Men"))
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv")
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv")
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))),
Participants =ifelse(Participants=="Women","Women","Men"))
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv")
county <- st_read("shapefiles/County.shp")
occupation_county1 <- full_join(county, occupation_county|>filter(Participants%in%"Women"), by=c("Name"="County")) |>
mutate(Participants="Women")
occupation_county2 <- full_join(county, occupation_county|>filter(Participants%in%"Men"), by=c("Name"="County")) |>
mutate(Participants="Men")
View(occupation_county1)
occupation_county3 <- rbind(occupation_county1, occupation_county2)
View(occupation_county3)
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
View(occupation_county)
occupation_county3 < - full_join(county,occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
occupation_county3 < - full_join(county,occupation_county, by=c("Name"="County"))
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
occupation_county3 < - full_join(county,occupation_county, by=c("Name"="County"))
View(occupation_county3)
county <- st_read("shapefiles/County.shp")
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
occupation_county3 < - full_join(county,occupation_county, by=c("Name"="County"))
occupation_county3 <- full_join(county ,occupation_county, by=c("Name"="County"))
View(occupation_county3)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv")
View(occupation_county)
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
occupation_county <- fread("data/table_3/table3_7C_occupation_by_county.csv") |>
mutate(cat=fifelse(Proportion<1.9, "<1.9", fifelse(Proportion>1.8 & Proportion<5.5, "1.9-5.4", fifelse(Proportion>5.4 & Proportion <9.5, "5.5-9.4",fifelse(Proportion>9.4&Proportion<18.5, "9.5-18.4", ">18.4")))))
write.csv(occupation_county, "data_2/table_3/table3_7C_occupation_by_county.csv")
occupation <- fread("data/table_3/table3_7_occupation_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
View(occupation)
occupation <- fread("data/table_3/table3_7_occupation_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(occupation, "data_2/table_3/table3_7_occupation_by_background_xtics.csv")
occupation <- fread("data/table_3/table3_7_occupation_by_background_xtics.csv")
View(county)
View(occupation)
occupation <- fread("data_2/table_3/table3_7_occupation_by_background_xtics.csv")
View(occupation)
occupation <- fread("data/table_3/table3_7_occupation_by_background_xtics.csv")
View(occupation)
occupation <- fread("data_2/table_3/table3_7_occupation_by_background_xtics.csv")
employment <-fread("data/table_3/table3_8_employment_by_background_xtics.csv") |>
mutate(Proportion=fifelse(Proportion>0.5, round(Proportion), Proportion))
write.csv(employment, "data_2/table_3/table3_8_employment_by_background_xtics.csv")
